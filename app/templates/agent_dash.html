<!DOCTYPE html>
<html>
<head>
  <title>Agent Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select, button { margin: 5px; padding: 8px; }
    .results { margin-top: 20px; }
    .property { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>
  <h2>Welcome to Your Dashboard</h2>

  <h3>Search Properties</h3>
  <form id="searchForm">
    <input type="text" id="city" placeholder="City">
    <input type="text" id="state" placeholder="State">
    <input type="number" id="price_min" placeholder="Min Price">
    <input type="number" id="price_max" placeholder="Max Price">
    <button type="submit">Search</button>
  </form>

  <div class="results" id="results"></div>

  <button id="viewAgentProfileBtn" class="view-profile-btn">View Profile</button>

  <script>
    document.getElementById('searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const res = await fetch('/api/search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          city: document.getElementById('city').value || null,
          state: document.getElementById('state').value || null,
          price_min: document.getElementById('price_min').value || null,
          price_max: document.getElementById('price_max').value || null,
        })
      });

      const data = await res.json();
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      if (data.results && data.results.length > 0) {
        data.results.forEach(p => {
          const div = document.createElement('div');
          div.className = 'property';
          div.innerHTML = `
            <strong>${p.city}, ${p.state}</strong><br>
            Price: $${Number(p.price).toLocaleString()}<br>
            ${p.description}<br><br>

            <label for="start_date_${p.property_id}">Start Date:</label>
            <input type="date" id="start_date_${p.property_id}" required><br>
            <label for="end_date_${p.property_id}">End Date:</label>
            <input type="date" id="end_date_${p.property_id}" required><br>
            <button onclick="bookProperty(${p.property_id})">Book Now</button>
          `;
          resultsDiv.appendChild(div);
        });
      } else {
        resultsDiv.innerText = 'No results found.';
      }
    });

    // Redirect to agent profile page on click
    document.getElementById('viewAgentProfileBtn').addEventListener('click', () => {
      window.location.href = '/agent/view-profile';
    });

    // Stub: bookProperty (if needed)
    function bookProperty(propertyId) {
      alert(`Booking function not implemented for property ${propertyId}`);
    }
  </script>
</body>
</html>
