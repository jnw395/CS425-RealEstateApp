<!DOCTYPE html>
<html>
<head>
    <title>Edit Agent Profile</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input { margin: 5px 0; padding: 8px; width: 250px; }
        button { padding: 8px 16px; }
        .msg { margin-top: 10px; color: red; }
    </style>
</head>
<body>
    <h2>Edit Agent Profile</h2>
    <form id="editAgentProfileForm">
        <input type="hidden" id="current_email" required><br>
        <input type="password" id="current_password" placeholder="Current Password" required><br>
        <input type="text" id="first_name" placeholder="First Name"><br>
        <input type="text" id="last_name" placeholder="Last Name"><br>
        <input type="email" id="new_email" placeholder="New Email"><br>
        <input type="password" id="new_password" placeholder="New Password"><br>
        <input type="text" id="job_title" placeholder="Job Title"><br>
        <input type="text" id="real_estate_agency" placeholder="Real Estate Agency"><br>
        <button type="submit">Update Profile</button>
    </form>
    <div class="msg" id="msg"></div>

    <script>
       const editAgentProfileForm = document.getElementById('editAgentProfileForm');
        const msgElement = document.getElementById('msg');

        // Get email from query parameter
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get('email');
        if (!email) {
            alert("Email is required to edit profile.");
            window.location.href = '/login';
        }
        document.getElementById('current_email').value = email;


        editAgentProfileForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const current_email = document.getElementById('current_email').value;
            const current_password = document.getElementById('current_password').value;
            const first_name = document.getElementById('first_name').value;
            const last_name = document.getElementById('last_name').value;
            const new_email = document.getElementById('new_email').value;
            const new_password = document.getElementById('new_password').value;
             const job_title = document.getElementById('job_title').value;
            const real_estate_agency = document.getElementById('real_estate_agency').value;

            const res = await fetch('/api/agent/edit-profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    current_email,
                    current_password,
                    first_name,
                    last_name,
                    new_email,
                    new_password,
                    job_title,
                    real_estate_agency
                })
            });

            const data = await res.json();
            msgElement.innerText = data.message;
            msgElement.style.color = res.ok ? 'green' : 'red';

            if (res.ok) {
                window.location.href = `/agent_profile.html?email=${current_email}`; // Redirect
            }
        });
    </script>
</body>
</html>